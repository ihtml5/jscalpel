!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.jscalpel={})}(this,function(t){"use strict";var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n=(function(){function t(t){this.value=t}function e(e){function n(o,a){try{var u=e[o](a),i=u.value;i instanceof t?Promise.resolve(i.value).then(function(t){n("next",t)},function(t){n("throw",t)}):r(u.done?"return":"normal",u.value)}catch(t){r("throw",t)}}function r(t,e){switch(t){case"return":o.resolve({value:e,done:!0});break;case"throw":o.reject(e);break;default:o.resolve({value:e,done:!1})}(o=o.next)?n(o.key,o.arg):a=null}var o,a;this._invoke=function(t,e){return new Promise(function(r,u){var i={key:t,arg:e,resolve:r,reject:u,next:null};a?a=a.next=i:(o=a=i,n(t,e))})},"function"!=typeof e.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)}}(),function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}),r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=Object.prototype.toString,a=function(t){return"[object Object]"===o.call(t)},u=function t(e){var n={},r=[];return"[object Object]"===o.call(e)?(Object.keys(e).forEach(function(a,u){Array.isArray(e[a])?(e[a].forEach(function(t,e){r.push(t)}),n[a]=r,r=[]):o.call("[object Object]"===e[a])&&(n[a]=t(e[a]))}),n):e},i=function(){function t(e){var r=e.target,o=e.returnedValue,a=e.error;n(this,t),this._target=r,this._error=a,this._returnedValue=o}return r(t,[{key:"_getValueByPath",value:function(t){for(var e=void 0,n=this._target,r=this._fallbackpath(t).split("."),o=0,a=r.length;o<a;o++)try{e=e?e[r[o]]:n[r[o]]}catch(t){return}return e}},{key:"_getValue",value:function(t){var e=void 0,n=[],r=this;return"string"==typeof t&&t.length>0?this._getValueByPath(t):"[object Array]"===o.call(t)?(t.forEach(function(t,o){"string"==typeof t&&(e=r._getValueByPath(t),n.push(e))}),0===n.length?null:n):null}},{key:"get",value:function(t){return t?this._getValueByPath(t):this._returnedValue}},{key:"_fallbackpath",value:function(t){return"string"!=typeof t?"":t.replace(/\s/g,"")}},{key:"_extend",value:function(t,e){if(a(t))for(var n=t,r=e.split("."),o=r.length,u=0;u<o;u++)void 0===n[r[u]]&&(n[r[u]]={}),n=(arguments.length<=2?0:arguments.length-2)>0&&u===o-1?n[r[u]]=arguments.length<=2?void 0:arguments[2]:n[r[u]]}},{key:"_setOrDel",value:function(t,e){var n=this._fallbackpath(t);""!==n?this._extend(this._target,n,e):"function"==typeof this._error&&this._error(this._target,t)}},{key:"set",value:function(t,e){var n=this;a(t)?Object.keys(t).forEach(function(e,r){n._setOrDel(e,t[e])}):this._setOrDel(t,e)}},{key:"has",value:function(t){return!!this._getValueByPath(t)}},{key:"del",value:function(t){var e=this;t&&(Array.isArray(t)?t.forEach(function(t,n){e._setOrDel(t,void 0)}):e._setOrDel(t,void 0))}}]),t}(),c=function(t,e){var n=t.target,r=t.path,a=t.keys,c=t.dynamicKeys,l=t.prefix,f=t.callback,s=t.success,y=t.deep,p=t.plugins,h=t.error,v=s||f,g=!!l,d=function(t){return l&&g?l+"."+t:""+t},b=function(t){for(var e=t.path,n=t.target,r=d(e).split("."),o=0,a=r.length;o<a;o++)try{n=n[r[o]]}catch(t){return}return n},m=function(t){var e=t.plugins,n=t.name,r={value:t.value,name:n};e&&Array.isArray(e)&&e.length&&e.forEach(function(t,e){t(r)})},_=void 0,k=void 0,j=function(t){var e=null;try{if(e="string"==typeof t?JSON.parse(t):t,y&&(e=u(e)),"[object Object]"!==o.call(e)&&!Array.isArray(e))return void("function"==typeof h&&h(e))}catch(t){return void("function"==typeof h&&h(e,t))}return e}(n),O=[],x=v?function(t){var e=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,n=/=[^,]+/gm,r=/=>.*$/gm,o=t.toString().replace(e,"").replace(r,"").replace(n,""),a=o.slice(o.indexOf("(")+1,o.indexOf(")")).match(/([^\s,]+)/g);return null===a?[]:a}(v):[];return"string"==typeof(r=function(t){var e=t.path,n=void 0===e?"":e,r=t.keys,o=t.dynamicKeys;return r||"function"==typeof o?n=r||o(l):"function"==typeof n&&(n=n(l)),n}({path:r,keys:a,dynamicKeys:c}))&&r.length>0?(k=b({path:r,target:n}),m({plugins:p,name:x[0],value:k}),_=v&&"function"==typeof v?v.call(null,k,j,r,e):v):"[object Array]"===o.call(r)&&(r.forEach(function(t,e){"string"==typeof t&&(k=b({path:t,target:n}),m({plugins:p,value:k,name:x[e]}),O.push(k)),k=void 0}),O.push(j,r,e),_=v&&"function"==typeof v?v.apply(null,O):v),"function"==typeof f||"function"==typeof s?_:new i({target:j,error:h})};t.default=c,t.jscalpelType=function(t){var n=t.value,r=t.name;return-1!==["string","undefined","function","number","boolean"].indexOf(void 0===n?"undefined":e(n))?{value:n,type:void 0===n?"undefined":e(n)}:n+""=="null"?{value:n,type:"null"}:Array.isArray(n)?{value:n,type:"array",length:n.length}:"[object Object]"===Object.prototype.toString.call(n)?{value:n,name:r,type:"object",keys:Object.keys(n),values:Object.values(n)}:void 0},t.jscalpelLogic=function(t){return function(e){var n=e.value,r=e.name;return t[r]&&c({target:t,prefix:""+r,path:["match","success"],callback:function(t,e){return t({value:n,name:r})&&e({value:n,name:r}),n}}),n}},t.jscalpelORM=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments[1],n=arguments[2];if(!a(t))return console.error("source为"+t+",不是对象"),n;if(!a(e))return console.error("rules为"+e+",不是对象"),n;try{var r=Object.keys(e),o=e._extraInfo||{},u={},i=c({target:u}),l=c({target:t});return r.forEach(function(t,n){"_extraInfo"!==t&&i.set(t,void 0===l.get(t)?l.get(e[t]):l.get(t))}),Object.assign(u,o)}catch(t){return console.error("请检查source和rules配置，两者都必须为对象!"),n}},t.get=function(t,e,n){var r=c({target:t}).get(e);return void 0===r?n:r},t.set=function(t,e,n){return c({target:t}).set(e,n)},t.toCopy=u,Object.defineProperty(t,"__esModule",{value:!0})});
