!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.jscalpel={})}(this,function(e){"use strict";var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=(function(){function e(e){this.value=e}function t(t){function n(o,u){try{var a=t[o](u),i=a.value;i instanceof e?Promise.resolve(i.value).then(function(e){n("next",e)},function(e){n("throw",e)}):r(a.done?"return":"normal",a.value)}catch(e){r("throw",e)}}function r(e,t){switch(e){case"return":o.resolve({value:t,done:!0});break;case"throw":o.reject(t);break;default:o.resolve({value:t,done:!1})}(o=o.next)?n(o.key,o.arg):u=null}var o,u;this._invoke=function(e,t){return new Promise(function(r,a){var i={key:e,arg:t,resolve:r,reject:a,next:null};u?u=u.next=i:(o=u=i,n(e,t))})},"function"!=typeof t.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)}}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){return"[object \bObject]"===Object.prototype.toString.call(e)},u=Object.prototype.toString,a=function(e){return"[object Object]"===u.call(e)},i=function(){function e(t){var r=t.target,o=t.returnedValue,u=t.error;n(this,e),this._target=r,this._error=u,this._returnedValue=o}return r(e,[{key:"_getValueByPath",value:function(e){for(var n=void 0,r=this._target,o=this._fallbackpath(e).split("."),u=0,a=o.length;u<a;u++)if(void 0===(void 0===(n=n?n[o[u]]:r[o[u]])?"undefined":t(n)))return n;return n}},{key:"_getValue",value:function(e){var t=void 0,n=[],r=this;return"string"==typeof e&&e.length>0?this._getValueByPath(e):"[object Array]"===u.call(e)?(e.forEach(function(e,o){"string"==typeof e&&(t=r._getValueByPath(e),n.push(t))}),0===n.length?null:n):null}},{key:"get",value:function(e){return e?this._getValueByPath(e):this._returnedValue}},{key:"_fallbackpath",value:function(e){return"string"!=typeof e?"":e}},{key:"_extend",value:function(e,t){if(a(e))for(var n=e,r=t.split("."),o=r.length,u=0;u<o;u++)void 0===n[r[u]]&&(n[r[u]]={}),n=(arguments.length<=2?0:arguments.length-2)>0&&u===o-1?n[r[u]]=arguments.length<=2?void 0:arguments[2]:n[r[u]]}},{key:"_setOrDel",value:function(e,t){var n=this._fallbackpath(e);""!==n?this._extend(this._target,n,t):"function"==typeof this._error&&this._error(this._target,e)}},{key:"set",value:function(e,t){var n=this;a(e)?Object.keys(e).forEach(function(t,r){n._setOrDel(t,e[t])}):this._setOrDel(e,t)}},{key:"has",value:function(e){return!!this._getValueByPath(e)}},{key:"del",value:function(e){var t=this;e&&(Array.isArray(e)?e.forEach(function(e,n){t._setOrDel(e,void 0)}):t._setOrDel(ph,void 0))}}]),e}(),c=function(e,t){var n=e.target,r=e.path,o=e.keys,a=e.dynamicKeys,c=e.prefix,l=e.callback,f=e.success,s=e.deep,y=e.plugins,p=e.error,v=f||l,h=!!c,g=function e(t){var n={},r=[];return"[object Object]"===u.call(t)?(Object.keys(t).forEach(function(o,a){Array.isArray(t[o])?(t[o].forEach(function(e,t){r.push(e)}),n[o]=r,r=[]):u.call("[object Object]"===t[o])&&(n[o]=e(t[o]))}),n):t},d=function(e){return c&&h?c+"."+e:""+e},b=function(e){for(var t=e.path,n=e.target,r=d(t).split("."),o=0,u=r.length;o<u;o++)if(void 0===(n=n[r[o]]))return n;return n},m=function(e){var t=e.plugins,n=e.name,r={value:e.value,name:n};t&&Array.isArray(t)&&t.length&&t.forEach(function(e,t){e(r)})},j=void 0,_=void 0,k=function(e){var t=null;try{if(t="string"==typeof e?JSON.parse(e):e,s&&(t=g(t)),"[object Object]"!==u.call(t)&&!Array.isArray(t))return void("function"==typeof p&&p(t))}catch(e){return void("function"==typeof p&&p(t,e))}return t}(n),O=[],x=v?function(e){var t=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,n=/=[^,]+/gm,r=/=>.*$/gm,o=e.toString().replace(t,"").replace(r,"").replace(n,""),u=o.slice(o.indexOf("(")+1,o.indexOf(")")).match(/([^\s,]+)/g);return null===u?[]:u}(v):[];return"string"==typeof(r=function(e){var t=e.path,n=void 0===t?"":t,r=e.keys,o=e.dynamicKeys;return r||"function"==typeof o?n=r||o(c):"function"==typeof n&&(n=n(c)),n}({path:r,keys:o,dynamicKeys:a}))&&r.length>0?(_=b({path:r,target:n}),m({plugins:y,name:x[0],value:_}),j=v&&"function"==typeof v?v.call(null,_,k,r,t):v):"[object Array]"===u.call(r)&&(r.forEach(function(e,t){"string"==typeof e&&(_=b({path:e,target:n}),m({plugins:y,value:_,name:x[t]}),O.push(_)),_=void 0}),O.push(k,r,t),j=v&&"function"==typeof v?v.apply(null,O):v),"function"==typeof l||"function"==typeof f?function(e,t,n){return void 0!==e?e:t}(j,_,O.slice(0,-3)):new i({target:k,error:p})};e.default=c,e.jscalpelType=function(e){var n=e.value,r=e.name;return-1!==["string","undefined","function","number","boolean"].indexOf(void 0===n?"undefined":t(n))?{value:n,type:void 0===n?"undefined":t(n)}:n+""=="null"?{value:n,type:"null"}:Array.isArray(n)?{value:n,type:"array",length:n.length}:"[object Object]"===Object.prototype.toString.call(n)?{value:n,name:r,type:"object",keys:Object.keys(n),values:Object.values(n)}:void 0},e.jscalpelLogic=function(e){return function(t){var n=t.value,r=t.name;return e[r]&&c({target:e,prefix:""+r,path:["match","success"],callback:function(e,t){return e({value:n,name:r})&&t({value:n,name:r}),n}}),n}},e.jscalpelORM=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],n=arguments[2];if(!o(e))return console.error("source为"+e+",不是对象"),n;if(!o(t))return console.error("rules为"+t+",不是对象"),n;try{var r=Object.keys(t),u=t._extraInfo||{},a={},i=c({target:a}),l=c({target:e});return r.forEach(function(e,n){i.set(e,void 0===l.get(e)?l.get(t[e]):l.get(e))}),Object.assign(e,a,u)}catch(e){return console.error("请检查source和rules配置，两者都必须为对象!"),n}},Object.defineProperty(e,"__esModule",{value:!0})});
